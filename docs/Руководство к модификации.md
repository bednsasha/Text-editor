# Руководство к модификации
## Введение
Разработаем модификацию нашего проекта, для этого выделим недостатки и проблемы текущего проекта.

**Из-за ограниченных возможностей Tkinter ( в частности Menu) сложно организовать  данную панель удобным и визуально приятным для пользователя образом, поскольку:**
+ Отсутствует прямая и простая реализация смены цвета меню;
+ Имеется очень ограниченное количество доступных элементов меню (нет возможности добавить в меню выпадающий список с прокруткой, поисковую строку или иконку);
  
В новой версии текстового редактора добавим функции для изменения:
+ Выравнивания
+ Цвета текста
+ Начертания текста
+ Размера текста

Для этих целей будем использовать фреймворк Python - Flet.

```python
import flet as ft
```

**Модифицированная версия будет также состоять из трех частей**: *панель быстрого доступа с логотипом приложения*, *меню* и *текстовое поле*. (Во Flet, не нужно отдельно создавать полосу прокрутки, она добавляется автоматически, если разрешить многострочный ввод)
## Создание окна

Создаем страницу будущего текстового редактора, задаем имя и изначальную тему:
```python
def main(page: ft.Page):
    page.title='Textopia'
    page.theme_mode='light'
ft.app(target=main)
```

![Окно приложения]()

## Создание текстового поля

**Начнем с создания текстового поля, для этого необходимо:**
1. Создать TextField и настроить его;
2. Добавить текстовое поле на страницу.

Также добавим разделительные полосы.
   
``` python
text_field = ft.TextField(
        expand=True, 
        content_padding=20,
        multiline=True,
        border_width=0,
        bgcolor=ft.Colors.SURFACE,
        focused_bgcolor=ft.Theme,
        selection_color='#e1bee7',
        text_size=int(txt_number.value),
        
    )
    text_field.hover_color=text_field.bgcolor

  
    page.add(ft.Divider(color=ft.Theme, thickness=3))
    page.add(text_field)
    page.add(ft.Divider(color=ft.Theme,thickness=3))
```
**multiline** - разрешаем многострочный ввод;

**text_size** - размер шрифта будем получать из соответствующего поля;

**ft.Theme** - данное значение означает, что будет установлен цвет, соответствующий текущей теме приложения.

![Текстовое поле]()

## Создание Appbar

![Appbar]()

На этой панели будет содержаться **информация о нашем приложении (иконка и логотип), имя текущего документа, кнопка для закрытия приложения и кнопка для смены темы**, а также  для быстрого доступа вынесем сюда **кнопку сохранения**.

### Иконка и логотип

``` python
leading=ft.Image(src='C:\\Users\\Honor\\Desktop\\иконка textopia.png',fit=ft.ImageFit.CONTAIN),
title=ft.Image(src='C:\\Users\\Honor\\Desktop\\лого практика уменьш.png',fit=ft.ImageFit.CONTAIN),
center_title=False
```
**fit=ft.ImageFit.CONTAIN** -
изображение пропорционально масштабируется, чтобы целиком поместиться внутри родительского элемента;

**center_title=False** - логотип не будет располагаться по центру.

![logo]()

### Имя текущего документа

**Функционал**

Изначально, до того, как пользователь откроет, либо создаст документ в поле задан текст (статус): "Новый документ". Надпись должна изменяться на имя файла при открытии, либо создании документа.

**Код**

```python
file_name=ft.Text(value='Новый документ', expand=True)
```

![file name]()

### Кнопка "Закрыть"

**Функционал**

Прекращение работы с текущим документом. Определим следующие ситуации прекращения работы с документом:

+ Если пользователь работал с новым документом и оставил текстовое поле пустым или не оставил никаких изменений в тексте уже существующего документа -> закрытие программы;
  
+ Если пользователь работал с новым документом и внес в него изменения не сохраняя или оставил несохраненные изменения в уже существующем документе -> предупреждение.

**Код**

``` python
banner=None

    def close_banner(e):
        # Скрываем баннер
        global banner
        page.close(banner)
        page.update()

    def close_doc_click(e):
        global banner  
        doc_text=text_field.value
        if file_path:  # Если существует путь к файлу
            
                with open(file_path, 'r', encoding='utf-8') as f:
                    doc_text = f.read()  
       
        if ((text_field.value == '') and (file_name.value == 'Новый документ')) or ((doc_text == text_field.value) and (file_name.value != 'Новый документ')):
            print(text_field.value, file_name)
            
            page.window.close()  # Закрыть приложение
        else:
            # Создаем баннер с предупреждением
            banner = ft.Banner(
                bgcolor=ft.Colors.AMBER_100,
                leading=ft.Icon(ft.Icons.WARNING_AMBER_ROUNDED, color=ft.Colors.AMBER, size=40),
                content=ft.Text(
                    value="У вас есть несохраненные изменения. Вы уверены, что хотите закрыть документ?",
                    color=ft.Colors.BLACK,
                ),
                actions=[
                    ft.TextButton(text="Все равно закрыть", on_click=lambda e:  page.window.close()),  # Закрывает приложение
                    ft.TextButton(text="Остаться", on_click=close_banner),  # Закрывает баннер
                ],
            )
            page.open(banner)  # Добавляем баннер на страницу
            page.update()

   
```
Создаем непосредственно саму кнопку:

``` python
close_icon_button=ft.IconButton(
        ft.Icons.CLOSE,
        icon_color=icon_color,
        hover_color='#e1bee7',
        on_click=close_doc_click
        )
```
![close button]()

### Кнопка "Смена темы"

**Функционал**

Меняем тему приложения в зависимости от текущей темы.

**Код**

Для начала установим изначальный цвет иконок:
``` python
icon_color = "#2d2d2d"
```
```python
def change_theme(e):
        nonlocal icon_color  # Используем nonlocal для изменения переменной вне функции
        page.theme_mode = 'light' if page.theme_mode == 'dark' else 'dark'
        # Меняем цвет темы в зависимости от текущей темы
        icon_color = '#ffffff' if page.theme_mode == 'dark' else '#2d2d2d'
        
        # Обновляем цвета иконок 
        theme_icon_button.icon_color = icon_color
        save_icon_button.icon_color = icon_color
        close_icon_button.icon_color = icon_color
        page.update()

    # Создаем IconButton для смены темы
    theme_icon_button = ft.IconButton(
        ft.Icons.SUNNY, 
        on_click=change_theme,  
        icon_color=icon_color, 
        hover_color='#e1bee7', 
        
    )
```
Пояснения: 
В Flet существует каталог цветов для тем, в котором для каждого светлого цвета идет в пару темный цвет, если выбрать один из них для темы, то при смене темы цвет автоматически поменяется на оставшийся из пары (нет необходимости прописывать это дополнительно).

![change theme light]()
![change theme dark]()

### Кнопка "Сохранить"

Опишем и создадим данную функцию позже вместе с остальными функциями работы с документом, а пока просто создадим иконку:

``` python
save_icon_button=ft.IconButton(
        ft.Icons.SAVE,
        icon_color=icon_color, 
        hover_color='#e1bee7', 
        on_click=save_doc_click)
```
![save doc]()

## Создание Menubar




